# 部署指南

## 部署到阿里云ESA Pages

### 前置准备

1. **注册阿里云账号**并开通ESA服务
2. **准备GitHub账号**，创建公开仓库
3. **加入赛事钉钉群**（群号：118400030886）领取代金券

### 步骤一：准备代码仓库

1. 将代码推送到GitHub公开仓库
2. 确保仓库包含以下文件：
   - `package.json`
   - `vite.config.ts`
   - `README.md`（包含ESA声明）

### 步骤二：部署前端到ESA Pages

1. 登录[阿里云ESA控制台](https://esa.console.aliyun.com/)
2. 进入 **Pages** 服务
3. 点击 **新建站点**
4. 选择 **从GitHub导入**
5. 授权GitHub账号并选择仓库
6. 配置构建设置：
   - **构建命令**：`npm install && npm run build`
   - **输出目录**：`dist`
   - **Node版本**：18.x
7. 点击 **部署**
8. 等待部署完成，获取访问URL

### 步骤三：配置边缘函数

1. 在ESA控制台进入 **边缘函数** 服务
2. 创建新函数，命名为 `whiteboard-server`
3. 上传 `edge-functions/whiteboard-server.js` 代码
4. 配置函数触发器：
   - **触发类型**：HTTP/WebSocket
   - **路径**：`/socket.io/*`
5. 绑定到Pages域名
6. 获取边缘函数的WebSocket端点URL

### 步骤四：配置环境变量

1. 在Pages项目设置中添加环境变量：
   ```
   VITE_SOCKET_URL=你的边缘函数WebSocket端点
   ```
2. 重新构建项目

### 步骤五：配置边缘存储（可选）

1. 在ESA控制台开通 **边缘存储** 服务
2. 创建存储桶，用于保存白板数据
3. 在边缘函数代码中配置存储桶信息
4. 更新边缘函数代码以使用存储API

### 步骤六：配置边缘缓存（可选）

1. 在ESA控制台配置 **边缘缓存** 策略
2. 设置缓存规则：
   - 缓存白板元数据
   - 缓存用户列表
   - 缓存时间：1小时
3. 在边缘函数中启用缓存逻辑

### 步骤七：测试部署

1. 访问Pages提供的URL
2. 测试以下功能：
   - 创建/加入房间
   - 多人协作绘图
   - 实时同步
   - 导出功能

### 步骤八：提交作品

1. 准备提交材料（TXT文件）：
   ```
   作品名称：边缘协作白板
   
   作品访问URL：https://your-pages-url.esa.com
   
   Github仓库地址：https://github.com/your-username/your-repo
   
   作品说明：
   本项目是一个基于阿里云ESA边缘计算平台构建的实时多人协作绘图应用。
   充分利用了ESA的完整边缘生态产品（Pages + 边缘函数 + 边缘存储 + 边缘缓存），
   实现了高性能、低延迟的实时协作体验。
   
   实用性：远程协作场景的刚需工具，在线教育、会议、头脑风暴等场景广泛应用。
   创意性：结合边缘计算优势，实现毫秒级实时同步，全球用户就近访问。
   技术深度：完整使用ESA边缘生态，WebSocket实时通信，Canvas绘图引擎优化。
   ```

2. 登录[天池大赛平台](https://tianchi.aliyun.com/)
3. 进入赛题页面，点击 **提交结果**
4. 上传TXT文件
5. 完成提交

## 常见问题

### Q: 部署后无法连接WebSocket？
A: 检查边缘函数的WebSocket端点配置是否正确，确保环境变量 `VITE_SOCKET_URL` 已设置。

### Q: 如何查看部署日志？
A: 在Pages控制台的"构建日志"中查看详细日志。

### Q: 边缘函数如何调试？
A: 可以在边缘函数控制台查看运行日志和错误信息。

### Q: 如何优化性能？
A: 
- 启用边缘缓存
- 优化Canvas渲染
- 使用CDN加速静态资源

## 技术支持

- ESA文档：https://help.aliyun.com/product/xxx.html
- 钉钉群：118400030886
- GitHub Issues：提交问题

