# 本地开发说明

## 问题：一直显示"连接中"

如果本地一直显示"连接中"，说明WebSocket服务器没有运行。

## 解决方案

### 方法一：启动本地WebSocket服务器（推荐）

1. **安装服务器依赖**（在项目根目录）：
   ```bash
   npm install socket.io
   ```

2. **启动WebSocket服务器**（新开一个终端）：
   ```bash
   npm run server
   ```
   或者：
   ```bash
   node server.js
   ```

   应该看到：
   ```
   🚀 WebSocket服务器运行在 http://localhost:8080
   📡 等待客户端连接...
   ```

3. **启动前端开发服务器**（另一个终端）：
   ```bash
   npm run dev
   ```

4. **访问应用**：
   打开浏览器访问 `http://localhost:3000`

### 方法二：使用边缘函数服务器

如果你已经配置了边缘函数服务器：

1. 进入 `edge-functions` 目录：
   ```bash
   cd edge-functions
   ```

2. 安装依赖：
   ```bash
   npm install
   ```

3. 启动服务器：
   ```bash
   npm run dev
   ```

4. 确保前端环境变量配置正确（`.env` 文件）：
   ```
   VITE_SOCKET_URL=http://localhost:8080
   ```

## 验证连接

1. 打开浏览器开发者工具（F12）
2. 查看 Console 标签
3. 应该看到：
   - `正在连接到WebSocket服务器: http://localhost:8080`
   - `WebSocket连接成功`

如果看到错误信息，检查：
- WebSocket服务器是否正在运行
- 端口8080是否被占用
- 防火墙是否阻止了连接

## 常见问题

### Q: 端口8080被占用？
A: 修改 `server.js` 中的端口号，或使用环境变量：
   ```bash
   PORT=3001 node server.js
   ```
   同时更新 `.env` 文件中的 `VITE_SOCKET_URL`

### Q: 仍然无法连接？
A: 
1. 检查服务器是否正常启动
2. 检查浏览器控制台的错误信息
3. 尝试使用 `http://127.0.0.1:8080` 而不是 `localhost:8080`

### Q: 生产环境如何配置？
A: 在ESA Pages部署时，设置环境变量 `VITE_SOCKET_URL` 为你的边缘函数WebSocket端点地址。

